<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®åœ‹åœ°æ”¿ï½œæ˜“ä¸åœ°æ”¿ - èˆŠåˆ¶è²¡ç”¢äº¤æ˜“æ‰€å¾—ç¨…ç²¾ç®— V21.4</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1A3C5C; /* å®åœ‹æ·±è— */
            --gold: #C5A065;    /* è³ªæ„Ÿé‡‘ */
            --light: #F4F7F6;
            --white: #FFFFFF;
            --text: #333333;
            --border: #D1D5DB;
            --accent-red: #D32F2F;
            --line-green: #06C755;
            --fb-blue: #1877F2;
        }

        /* Nexus Protection: ç¦æ­¢æ–‡å­—é¸å–ï¼Œé˜²æ­¢ç›´æ¥è¤‡è£½å…§å®¹ */
        body {
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
        }
        /* å…è¨±è¼¸å…¥æ¡†å…§å®¹è¢«é¸å–ï¼Œå¦å‰‡ä½¿ç”¨è€…ç„¡æ³•ä¿®æ”¹è¼¸å…¥å€¼ */
        input, select {
            -webkit-user-select: auto;
            -ms-user-select: auto;
            user-select: auto;
        }

        * { box-sizing: border-box; outline: none; }
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background: var(--light); 
            color: var(--text); 
            margin: 0; 
            padding: 20px 20px 100px 20px;
            line-height: 1.6;
            position: relative;
            min-height: 100vh;
        }

        /* æµ®æ°´å° */
        .watermark-container {
            position: fixed;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 500px;
            z-index: 0;
            pointer-events: none;
            opacity: 0.06;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        .watermark-container img { width: 100%; height: auto; object-fit: contain; }

        /* Header */
        .header { text-align: center; margin-bottom: 30px; background: var(--white); padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-top: 5px solid var(--gold); position: relative; z-index: 1; }
        .logo-group { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 15px; }
        .logo-group img { height: 60px; object-fit: contain; }
        .header h1 { font-size: 1.8rem; color: var(--primary); margin: 5px 0; font-weight: 800; }
        .header .subtitle { color: #666; font-size: 1rem; }

        /* Container */
        .container { max-width: 900px; margin: 0 auto; position: relative; z-index: 1; }

        /* Tabs */
        .tab-group { display: flex; margin-bottom: 20px; background: #E0E0E0; border-radius: 8px; padding: 4px; }
        .tab { flex: 1; text-align: center; padding: 12px; cursor: pointer; border-radius: 6px; font-weight: bold; color: #666; transition: 0.3s; }
        .tab.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* Cards */
        .card { background: var(--white); padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; display: none; }
        .card.active { display: block; animation: fadeIn 0.5s; }
        .card-header { font-size: 1.2rem; font-weight: 700; color: var(--primary); border-bottom: 2px solid #F0F0F0; padding-bottom: 10px; margin-bottom: 20px; }

        /* Inputs */
        .input-group { margin-bottom: 15px; }
        .label { display: block; font-size: 0.9rem; font-weight: 600; color: #555; margin-bottom: 5px; }
        .input-row { display: flex; gap: 15px; align-items: flex-end; }
        .input-col { flex: 1; }
        
        input, select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 1rem; text-align: right; background: #FAFAFA; }
        select { text-align: left; }
        input:focus, select:focus { border-color: var(--primary); background: #FFF; box-shadow: 0 0 0 3px rgba(26, 60, 92, 0.1); }
        .input-readonly { background: #EEE; color: #777; cursor: default; }

        /* Helper & Zones */
        .helper-box { background: #FFF8E1; border: 1px dashed var(--gold); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .helper-title { font-size: 0.9rem; font-weight: bold; color: #B7791F; margin-bottom: 10px; }
        
        .luxury-calc-zone { 
            display: none; background: #FFEBEE; border: 1px solid #FFCDD2; padding: 15px; border-radius: 8px; margin-top: 15px; animation: fadeIn 0.5s;
        }
        .luxury-title { color: var(--accent-red); font-weight: bold; margin-bottom: 10px; display: block; }

        .btn-calc { background: var(--primary); color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer; font-size: 0.85rem; height: 42px; margin-top: 2px; }

        /* Results */
        .result-box { background: #EBF5FB; border-left: 5px solid var(--primary); padding: 20px; border-radius: 4px; margin-top: 25px; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 1rem; border-bottom: 1px solid #D6EAF8; padding-bottom: 5px; }
        .result-val { font-weight: bold; color: var(--primary); font-family: 'Consolas', monospace; }
        .result-val.highlight { color: var(--accent-red); font-size: 1.2rem; }
        .luxury-warning { color: var(--accent-red); font-size: 0.85rem; margin-top: 10px; padding: 10px; background: #FFEBEE; border-radius: 4px; display: none; }

        /* Footer */
        .footer-copyright { text-align: center; color: #999; font-size: 0.8rem; margin-top: 40px; position: relative; z-index: 1; }
        .contact-bar { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 20px; }
        .btn-contact { display: inline-flex; align-items: center; gap: 5px; padding: 10px 15px; border-radius: 50px; text-decoration: none; color: white; font-weight: bold; font-size: 0.9rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .btn-contact:hover { transform: translateY(-2px); }
        .btn-line { background: var(--line-green); }
        .btn-fb { background: var(--fb-blue); }
        .btn-google { background: #EA4335; }
        .btn-vip { background: var(--gold); }
        .btn-print { background: var(--text); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media print {
            .btn-contact, .tab-group { display: none; }
            .card { display: block; box-shadow: none; border: 1px solid #000; margin-bottom: 30px; }
            #tab1, #tab2 { display: block !important; }
            body { padding: 0; }
            .watermark-container { opacity: 0.05; }
        }
    </style>
</head>
<body oncontextmenu="return false;"> <div class="watermark-container">
    <img src="å®åœ‹åœ°æ”¿å°é¢.jpg" alt="å®åœ‹åœ°æ”¿">
    <img src="æ˜“ä¸logo-01.jpg" alt="æ˜“ä¸åœ°æ”¿">
</div>

<div class="header">
    <div class="logo-group">
        <img src="å®åœ‹åœ°æ”¿å°é¢.jpg" alt="å®åœ‹åœ°æ”¿">
        <img src="æ˜“ä¸logo-01.jpg" alt="æ˜“ä¸åœ°æ”¿">
    </div>
    <h1>å®åœ‹åœ°æ”¿ï½œæ˜“ä¸åœ°æ”¿</h1>
    <div class="subtitle">èˆŠåˆ¶è²¡ç”¢äº¤æ˜“æ‰€å¾—ç¨…ç²¾ç®—ç³»çµ± V21.4</div>
</div>

<div class="container">

    <div class="tab-group">
        <div class="tab active" onclick="switchTab('tab1')">æƒ…å¢ƒ Aï¼šæ¨™æº–èªå®š<br><span style="font-size:0.8rem">(101.08å‰ / è±ªå®…ç¨…)</span></div>
        <div class="tab" onclick="switchTab('tab2')">æƒ…å¢ƒ Bï¼šæ ¸å¯¦èªå®š<br><span style="font-size:0.8rem">(101.08å¾Œ / å»ºå•†äº¤æ˜“)</span></div>
    </div>

    <div id="tab1" class="card active">
        <div class="card-header">
            <span>æˆ¿å±‹è©•å®šç¾å€¼ Ã— æ¨™æº–ç¨…ç‡ (æˆ–è±ªå®…æˆ¿åœ°æ¯”)</span>
        </div>

        <div class="helper-box">
            <div class="helper-title">ğŸ’¡ ä¸çŸ¥é“æˆ¿å±‹è©•å®šç¾å€¼ï¼Ÿå¾ç¨…å–®åæ¨</div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">æˆ¿å±‹ç¨…å–®é‡‘é¡ (å…ƒ)</label>
                    <input type="number" id="taxBill_A" placeholder="ä¾‹: 5000">
                </div>
                <div class="input-col">
                    <label class="label">ç¨…ç‡ %</label>
                    <select id="taxRate_A">
                        <option value="1.2">1.2% (è‡ªç”¨ä½å®…)</option>
                        <option value="1.5">1.5% (éè‡ªç”¨)</option>
                        <option value="2.4">2.4% (éè‡ªç”¨)</option>
                        <option value="3">3.0% (ç‡Ÿæ¥­ç”¨)</option>
                    </select>
                </div>
                <div class="input-col" style="flex:0 0 80px;">
                    <button class="btn-calc" onclick="calcHouseVal('A')">åæ¨</button>
                </div>
            </div>
        </div>

        <div class="input-group">
            <label class="label">æˆ¿å±‹è©•å®šç¾å€¼ (å…ƒ)</label>
            <input type="number" id="houseVal_A" placeholder="è«‹è¼¸å…¥æˆ–ç”±ä¸Šæ–¹åæ¨" oninput="calcA()">
        </div>

        <div class="input-row">
            <div class="input-col">
                <label class="label">äº¤æ˜“ç¸£å¸‚</label>
                <select id="city_A" onchange="updateDistricts('A'); calcA();">
                    <option value="">è«‹é¸æ“‡</option>
                    <option value="Taipei">è‡ºåŒ—å¸‚</option>
                    <option value="NewTaipei">æ–°åŒ—å¸‚</option>
                    <option value="Taoyuan">æ¡ƒåœ’å¸‚</option>
                    <option value="Taichung">è‡ºä¸­å¸‚</option>
                    <option value="Tainan">è‡ºå—å¸‚</option>
                    <option value="Kaohsiung">é«˜é›„å¸‚</option>
                    <option value="OtherCity">å…¶ä»–ç¸£å¸‚</option>
                </select>
            </div>
            <div class="input-col">
                <label class="label">è¡Œæ”¿å€ (æ¨™æº–ç‡)</label>
                <select id="district_A" onchange="calcA()">
                    <option value="0">è«‹å…ˆé¸ç¸£å¸‚</option>
                </select>
            </div>
        </div>
        
        <div class="input-row">
            <div class="input-col">
                <label class="label">æˆ¿åœ°æˆäº¤ç¸½åƒ¹ (è¬å…ƒ)</label>
                <input type="number" id="totalPrice_A" placeholder="åˆ¤æ–·è±ªå®…ç¨…åŸºæº–" oninput="calcA()">
            </div>
            <div class="input-col">
                <label class="label">å°ˆæœ‰éƒ¨åˆ†åªæ•¸ (ä¸å«è»Šä½)</label>
                <input type="number" id="areaPing_A" placeholder="åˆ¤æ–·å–®åƒ¹è±ªå®…" oninput="calcA()">
            </div>
        </div>

        <div id="unitPriceDisplay" style="text-align:right; font-size:0.8rem; color:#666; margin-top:-10px; margin-bottom:10px; display:none;">
            è¨ˆç®—å–®åƒ¹ï¼š<span id="valUnitPrice">0</span> è¬/åª
        </div>

        <div id="luxuryZone_A" class="luxury-calc-zone">
            <span class="luxury-title">âš ï¸ å·²é”è±ªå®…é–€æª»ï¼éœ€è¼¸å…¥åœŸåœ°è³‡æ–™è¨ˆç®—æˆ¿åœ°æ¯”</span>
            <div style="font-size:0.85rem; color:#D32F2F; margin-bottom:10px;">
                åˆ¤å®šåŸå› ï¼š<span id="luxuryReason_A"></span>
            </div>
            <div class="input-row">
                <div class="input-col">
                    <label class="label">åœŸåœ°å…¬å‘Šç¾å€¼ (å…ƒ/mÂ²)</label>
                    <input type="number" id="landPrice_A" oninput="calcA()">
                </div>
                <div class="input-col">
                    <label class="label">åœŸåœ°ç§»è½‰é¢ç© (mÂ²)</label>
                    <input type="number" id="landArea_A" oninput="calcA()">
                </div>
            </div>
            <div class="input-group">
                <label class="label">åœŸåœ°å…¬å‘Šç¾å€¼ç¸½é¡ (å…ƒ)</label>
                <input type="number" id="totalLandVal_A" class="input-readonly" readonly>
            </div>
            <p style="font-size:0.8rem; color:#666;">
                *è¨ˆç®—å…¬å¼ï¼šæˆäº¤ç¸½åƒ¹ Ã— (æˆ¿å±‹ç¾å€¼ / (æˆ¿å±‹ç¾å€¼+åœŸåœ°ç¾å€¼)) Ã— 20%
            </p>
        </div>

        <div class="result-box">
            <div class="result-row">
                <span>è¨ˆç®—æ–¹å¼ï¼š</span>
                <span class="result-val" id="calcMethod_A">æ¨™æº–ç‡æ³•</span>
            </div>
            <div class="result-row">
                <span>æ ¸å®šè²¡ç”¢äº¤æ˜“æ‰€å¾—ï¼š</span>
                <span class="result-val highlight" id="result_A">0 å…ƒ</span>
            </div>
        </div>
    </div>

    <div id="tab2" class="card">
        <div class="card-header">
            <span>æˆ¿åœ°æ¯”æ ¸å¯¦èªå®š (å¯¦åƒ¹èª²ç¨…)</span>
        </div>

        <div class="input-row">
            <div class="input-col">
                <label class="label">è³£å‡ºç¸½é‡‘é¡ (è¬)</label>
                <input type="number" id="sellPrice_B" oninput="calcB()">
            </div>
            <div class="input-col">
                <label class="label">è²·å…¥ç¸½é‡‘é¡ (è¬)</label>
                <input type="number" id="buyPrice_B" oninput="calcB()">
            </div>
        </div>
        <div class="input-group">
            <label class="label">ç›¸é—œå¯æ‰£é™¤è²»ç”¨ (è¬)</label>
            <input type="number" id="expenses_B" value="0" placeholder="ä»²ä»‹è²»ã€å¥‘ç¨…ã€ä»£æ›¸è²»ã€è£ä¿®è²»" oninput="calcB()">
        </div>

        <div class="helper-box" style="border-color: var(--primary);">
            <div class="helper-title">ğŸ“ æˆ¿åœ°æ¯”è¨ˆç®— (åœŸåœ°å…¬å‘Šç¾å€¼ + æˆ¿å±‹è©•å®šç¾å€¼)</div>
            
            <div class="input-row">
                <div class="input-col">
                    <label class="label">åœŸåœ°å…¬å‘Šç¾å€¼ (å…ƒ/mÂ²)</label>
                    <input type="number" id="landPricePerSqm" oninput="calcLandValB()">
                </div>
                <div class="input-col">
                    <label class="label">åœŸåœ°ç§»è½‰é¢ç© (mÂ²)</label>
                    <input type="number" id="landAreaSqm" oninput="calcLandValB()">
                </div>
            </div>
            <div class="input-group">
                <label class="label">åœŸåœ°å…¬å‘Šç¾å€¼ç¸½é¡ (å…ƒ)</label>
                <input type="number" id="totalLandVal_B" class="input-readonly" readonly>
            </div>

            <div class="input-row">
                <div class="input-col">
                    <label class="label">æˆ¿å±‹è©•å®šç¾å€¼ (å…ƒ)</label>
                    <input type="number" id="houseVal_B" oninput="calcB()">
                </div>
                <div class="input-col" style="flex:0 0 80px;">
                    <button class="btn-calc" onclick="calcHouseVal('B')">åæ¨</button>
                </div>
            </div>
            <div id="helperB" style="display:none; margin-top:10px; background:#fff; padding:10px; border-radius:4px;">
                 ç¨…å–®é‡‘é¡ <input type="number" id="taxBill_B" style="width:80px; text-align:right;"> Ã· ç¨…ç‡ <input type="number" id="taxRate_B" value="1.2" style="width:50px; text-align:right;">% 
                 <button onclick="runHelperB()" style="cursor:pointer; padding:2px 5px;">ç¢ºèª</button>
            </div>
        </div>

        <div class="input-group">
            <label class="label">è¨ˆç®—çµæœï¼šæˆ¿åœ°æ¯” (æˆ¿å±‹åƒ¹å€¼ä½”æ¯”)</label>
            <input type="text" id="houseRatio_B" class="input-readonly" readonly style="font-weight:bold; color:var(--primary);">
        </div>
        
        <div class="result-box">
            <div class="result-row">
                <span>æˆ¿åœ°ç¸½ç²åˆ© (å”®-è²·-è²»)ï¼š</span>
                <span class="result-val" id="totalProfit_B">0 å…ƒ</span>
            </div>
            <div class="result-row" style="background:#FFF9C4;">
                <span>â˜… è²¡ç”¢äº¤æ˜“æ‰€å¾— (ä¾æˆ¿åœ°æ¯”)ï¼š</span>
                <span class="result-val highlight" id="finalIncome_B">0 å…ƒ</span>
            </div>
        </div>
    </div>

    <div class="footer-copyright">
        <p>Copyright Â© å®åœ‹åœ°æ”¿ï½œæ˜“ä¸åœ°æ”¿å‡ºç‰ˆ All Rights Reserved.</p>
        <div class="contact-bar">
            <a href="https://line.me/R/ti/p/@604gpqef" target="_blank" class="btn-contact btn-line">
                <i>ğŸ’¬</i> å®˜æ–¹ LINE
            </a>
            <a href="https://maps.app.goo.gl/qyKhdrKsG5QBo2BW8" target="_blank" class="btn-contact btn-google">
                <i>ğŸ“</i> Google è©•è«–
            </a>
            <a href="https://www.facebook.com/062582589a/" target="_blank" class="btn-contact btn-fb">
                <i>f</i> FB ç²‰çµ²é 
            </a>
            <a href="https://line.me/ti/g2/aVklWxyLP1RtfstQsslGQOlP4KViuFI7PPucdQ?utm_source=invitation&utm_medium=link_copy&utm_campaign=default" target="_blank" class="btn-contact btn-vip">
                <i>ğŸ‘‘</i> VIP ç¤¾ç¾¤
            </a>
            <button onclick="window.print()" class="btn-contact btn-print">
                <i>ğŸ–¨ï¸</i> åˆ—å°/å­˜æª”
            </button>
        </div>
    </div>

</div>

<script>
    // --- ç¨…ç‡èˆ‡è±ªå®…æ¨™æº–è³‡æ–™ ---
    const taxData = {
        'Taipei': { 
            'luxury_price': 6000, 'luxury_unit': 120,
            'districts': { 'ä¸­å±±å€': 48, 'æ¾å±±å€': 48, 'ä¸­æ­£å€': 48, 'å¤§å®‰å€': 48, 'ä¿¡ç¾©å€': 48, 'å£«æ—å€': 46, 'å…§æ¹–å€': 46, 'å¤§åŒå€': 46, 'å—æ¸¯å€': 46, 'åŒ—æŠ•å€': 45, 'è¬è¯å€': 45, 'æ–‡å±±å€': 45 } 
        },
        'NewTaipei': { 
            'luxury_price': 4000, 'luxury_unit': 75,
            'districts': { 'æ¿æ©‹å€': 44, 'æ°¸å’Œå€': 44, 'ä¸­å’Œå€': 44, 'ä¸‰é‡å€': 44, 'æ–°åº—å€': 44, 'è˜†æ´²å€': 44, 'æ–°èŠå€': 44, 'åœŸåŸå€': 44, 'æ—å£å€': 42, 'æ±æ­¢å€': 41, 'æ¨¹æ—å€': 41, 'æ³°å±±å€': 36, 'äº”è‚¡å€': 34, 'ä¸‰å³½å€': 34, 'æ·¡æ°´å€': 29, 'å…«é‡Œå€': 27, 'é¶¯æ­Œå€': 24, 'æ·±å‘å€': 23, 'å…¶ä»–': 14 } 
        },
        'Taoyuan': { 
            'luxury_price': 3000, 'luxury_unit': 50,
            'districts': { 'æ¡ƒåœ’å€': 33, 'ä¸­å£¢å€': 33, 'é¾œå±±å€': 32, 'è˜†ç«¹å€': 32, 'å…«å¾·å€': 32, 'å¹³é®å€': 26, 'å¤§åœ’å€': 24, 'é¾æ½­å€': 23, 'æ¥Šæ¢…å€': 23, 'æ–°å±‹å€': 18, 'è§€éŸ³å€': 16, 'å¾©èˆˆå€': 8 } 
        },
        'Taichung': { 
            'luxury_price': 3000, 'luxury_unit': 50,
            'districts': { 'è¥¿å±¯å€': 35, 'å—å±¯å€': 35, 'åŒ—å±¯å€': 32, 'è¥¿å€': 32, 'æ±å€': 30, 'å—å€': 30, 'åŒ—å€': 30, 'ä¸­å€': 26, 'çƒæ—¥å€': 24, 'å¤ªå¹³å€': 24, 'å¤§é‡Œå€': 24, 'æ½­å­å€': 22, 'è±åŸå€': 22, 'æ²™é¹¿å€': 22, 'å¤§é›…å€': 22, 'éœ§å³°å€': 21, 'å…¶ä»–': 15 } 
        },
        'Tainan': { 
            'luxury_price': 3000, 'luxury_unit': 50,
            'districts': { 'æ±å€': 30, 'å®‰å—å€': 28, 'ä¸­è¥¿å€': 28, 'åŒ—å€': 28, 'å®‰å¹³å€': 28, 'æ°¸åº·å€': 26, 'å—å€': 26, 'æ–°å¸‚å€': 24, 'å–„åŒ–å€': 23, 'å®‰å®šå€': 22, 'æ­¸ä»å€': 22, 'ä»å¾·å€': 22, 'æ–°ç‡Ÿå€': 20, 'å…¶ä»–': 10 } 
        },
        'Kaohsiung': { 
            'luxury_price': 3000, 'luxury_unit': 50,
            'districts': { 'å·¦ç‡Ÿå€': 37, 'é¼“å±±å€': 37, 'ä¸‰æ°‘å€': 37, 'è‹“é›…å€': 35, 'å‰é®å€': 35, 'å‰é‡‘å€': 34, 'æ¥ æ¢“å€': 33, 'å°æ¸¯å€': 33, 'æ–°èˆˆå€': 32, 'é³³å±±å€': 29, 'æ©‹é ­å€': 26, 'ä»æ­¦å€': 26, 'é¹½åŸ•å€': 26, 'å…¶ä»–': 15 } 
        },
        'OtherCity': { 
            'luxury_price': 2200, 'luxury_unit': 35,
            'districts': { 'æ–°ç«¹ç¸£å¸‚': 37, 'ä¸€èˆ¬ç¸£å¸‚': 18 } 
        }
    };

    function switchTab(tabId) {
        document.querySelectorAll('.card').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function updateDistricts(type) {
        let city = document.getElementById('city_' + type).value;
        let distSelect = document.getElementById('district_' + type);
        distSelect.innerHTML = '<option value="0">è«‹é¸æ“‡å€åŸŸ</option>';
        if (taxData[city]) {
            for (let [dist, rate] of Object.entries(taxData[city].districts)) {
                let opt = document.createElement('option');
                opt.value = rate;
                opt.text = dist + ` (${rate}%)`;
                distSelect.add(opt);
            }
        }
    }

    // --- åæ¨æˆ¿å±‹ç¾å€¼ ---
    function calcHouseVal(type) {
        if(type === 'B') { document.getElementById('helperB').style.display = 'block'; return; }
        let tax = parseFloat(document.getElementById('taxBill_' + type).value) || 0;
        let rate = parseFloat(document.getElementById('taxRate_' + type).value) || 0;
        if (rate > 0) {
            let val = Math.round(tax / (rate / 100));
            document.getElementById('houseVal_' + type).value = val;
            if(type === 'A') calcA();
        }
    }
    function runHelperB() {
        let tax = parseFloat(document.getElementById('taxBill_B').value) || 0;
        let rate = parseFloat(document.getElementById('taxRate_B').value) || 0;
        if (rate > 0) {
            let val = Math.round(tax / (rate / 100));
            document.getElementById('houseVal_B').value = val;
            document.getElementById('helperB').style.display = 'none';
            calcB();
        }
    }

    // --- æƒ…å¢ƒ A (å«è±ªå®…å–®åƒ¹èˆ‡ç¸½åƒ¹åˆ¤æ–·) ---
    function calcA() {
        let houseVal = parseFloat(document.getElementById('houseVal_A').value) || 0;
        let distRate = parseFloat(document.getElementById('district_A').value) || 0;
        let totalPrice = parseFloat(document.getElementById('totalPrice_A').value) || 0; // è¬å…ƒ
        let areaPing = parseFloat(document.getElementById('areaPing_A').value) || 0; // å°ˆæœ‰åªæ•¸
        let city = document.getElementById('city_A').value;

        // è±ªå®…é–€æª»æª¢æŸ¥ (é›™è»Œ)
        let isLuxury = false;
        let reason = "";

        if (city && taxData[city]) {
            let limitPrice = taxData[city].luxury_price;
            let limitUnit = taxData[city].luxury_unit;
            
            let unitPrice = (areaPing > 0) ? (totalPrice / areaPing) : 0;

            // 1. ç¸½åƒ¹æª¢æŸ¥
            if (totalPrice >= limitPrice) {
                isLuxury = true;
                reason = `æˆäº¤ç¸½åƒ¹ ${totalPrice}è¬ â‰§ ${limitPrice}è¬`;
            } 
            // 2. å–®åƒ¹æª¢æŸ¥
            else if (unitPrice >= limitUnit) {
                isLuxury = true;
                reason = `æˆäº¤å–®åƒ¹ ${unitPrice.toFixed(1)}è¬/åª â‰§ ${limitUnit}è¬/åª`;
            }
            
            // é¡¯ç¤ºå–®åƒ¹åƒè€ƒ
            let unitDisplay = document.getElementById('unitPriceDisplay');
            if(areaPing > 0) {
                unitDisplay.style.display = 'block';
                document.getElementById('valUnitPrice').innerText = unitPrice.toFixed(1);
            } else {
                unitDisplay.style.display = 'none';
            }
        }

        let luxuryZone = document.getElementById('luxuryZone_A');
        
        if (isLuxury) {
            luxuryZone.style.display = 'block';
            document.getElementById('luxuryReason_A').innerText = reason;
            
            // è±ªå®…è¨ˆç®—ï¼šæˆ¿åœ°æ¯” * 20%
            let landPrice = parseFloat(document.getElementById('landPrice_A').value) || 0;
            let landArea = parseFloat(document.getElementById('landArea_A').value) || 0;
            let totalLand = Math.round(landPrice * landArea);
            document.getElementById('totalLandVal_A').value = totalLand;

            let ratio = 0;
            if (houseVal + totalLand > 0) {
                ratio = houseVal / (houseVal + totalLand);
            }
            
            // æ­¸å±¬æˆ¿å±‹æ”¶å…¥ = ç¸½åƒ¹(å…ƒ) * æˆ¿åœ°æ¯”
            let totalPriceYuan = totalPrice * 10000;
            let houseIncome = totalPriceYuan * ratio;
            // æ‰€å¾—é¡ = æ”¶å…¥ * 20%
            let income = Math.round(houseIncome * 0.20);
            
            document.getElementById('calcMethod_A').innerText = `è±ªå®…æ ¸å¯¦èªå®š (æˆ¿åœ°æ¯” ${ (ratio*100).toFixed(2) }% Ã— 20%)`;
            document.getElementById('result_A').innerText = income.toLocaleString() + " å…ƒ";
            document.getElementById('rateDisplay_A').innerText = "20% (è±ªå®…ç¨…ç‡)";

        } else {
            luxuryZone.style.display = 'none';
            // ä¸€èˆ¬æ¨™æº–ç‡è¨ˆç®—
            document.getElementById('calcMethod_A').innerText = `æ¨™æº–ç‡æ³• (${distRate}%)`;
            document.getElementById('rateDisplay_A').innerText = distRate + "%";
            let income = Math.round(houseVal * (distRate / 100));
            document.getElementById('result_A').innerText = income.toLocaleString() + " å…ƒ";
        }
    }

    // --- æƒ…å¢ƒ B (æ ¸å¯¦èªå®š) ---
    function calcLandValB() {
        let price = parseFloat(document.getElementById('landPricePerSqm').value) || 0;
        let area = parseFloat(document.getElementById('landAreaSqm').value) || 0;
        let total = Math.round(price * area);
        document.getElementById('totalLandVal_B').value = total;
        calcB();
    }

    function calcB() {
        let buy = (parseFloat(document.getElementById('buyPrice_B').value) || 0) * 10000;
        let sell = (parseFloat(document.getElementById('sellPrice_B').value) || 0) * 10000;
        let exp = (parseFloat(document.getElementById('expenses_B').value) || 0) * 10000;
        
        let houseVal = parseFloat(document.getElementById('houseVal_B').value) || 0;
        let landVal = parseFloat(document.getElementById('totalLandVal_B').value) || 0;

        // 1. è¨ˆç®—æˆ¿åœ°æ¯”
        let totalAssessed = houseVal + landVal;
        let ratio = 0;
        if (totalAssessed > 0) {
            ratio = houseVal / totalAssessed;
        }
        document.getElementById('houseRatio_B').value = (ratio * 100).toFixed(2) + "%";

        // 2. è¨ˆç®—å¯¦éš›ç¸½ç²åˆ©
        let totalProfit = sell - buy - exp;
        document.getElementById('totalProfit_B').innerText = Math.round(totalProfit).toLocaleString() + " å…ƒ";

        // 3. æ‡‰ç”³å ±è²¡ç”¢äº¤æ˜“æ‰€å¾— (ä¾æˆ¿åœ°æ¯”)
        let finalIncome = Math.round(totalProfit * ratio);
        if (finalIncome < 0) finalIncome = 0;
        document.getElementById('finalIncome_B').innerText = finalIncome.toLocaleString() + " å…ƒ";
    }

    // --- Nexus Protection Logic: é˜²æ­¢åŸå§‹ç¢¼æª¢è¦–èˆ‡è¤‡è£½ ---
    document.addEventListener('keydown', function(e) {
        // é˜»æ“‹ F12
        if (e.key === 'F12' || e.keyCode === 123) {
            e.preventDefault();
            return false;
        }
        // é˜»æ“‹ Ctrl+Shift+I (é–‹ç™¼è€…å·¥å…·)
        if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i')) {
            e.preventDefault();
            return false;
        }
        // é˜»æ“‹ Ctrl+U (æª¢è¦–åŸå§‹ç¢¼)
        if (e.ctrlKey && (e.key === 'U' || e.key === 'u')) {
            e.preventDefault();
            return false;
        }
        // é˜»æ“‹ Ctrl+S (å¦å­˜æ–°æª” - éƒ¨åˆ†ç€è¦½å™¨æœ‰æ•ˆ)
        if (e.ctrlKey && (e.key === 'S' || e.key === 's')) {
            e.preventDefault();
            return false;
        }
    });

    // å†æ¬¡ç¢ºä¿å³éµç„¡æ•ˆ (é›™é‡ä¿éšª)
    document.oncontextmenu = function() { return false; };
</script>

</body>
</html>